{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Total Enrolment Of Different Stage Of Education",
  "width": "container",
  "data": {
    "url": "https://raw.githubusercontent.com/LobsterGT/DV2/refs/heads/main/data/enrolment_school_district.csv"
  },
  "transform": [
    {"filter": "datum.state == 'Malaysia'"},
    {"filter": "datum.sex == 'both'"},
    {
      "aggregate": [
        {"op": "mean", "field": "students", "as": "avg_students"}
      ],
      "groupby": ["stage"]
    },
    {
      "window": [{"op": "sum", "field": "avg_students", "as": "total"}]
    },
    {
      "calculate": "datum.avg_students / total * 100",
      "as": "percent"
    }
  ],
  "mark": {
    "type": "arc",
    "innerRadius": 60
  },
  "encoding": {
    "theta": {"field": "avg_students", "type": "quantitative"},
    "color": {"field": "stage", "type": "nominal"},
    "text": {"field": "percent", "type": "quantitative", "format": ".1f"},
    "tooltip": [
      {"field": "stage", "title": "Stage"},
      {"field": "avg_students", "type": "quantitative", "title": "Average enrolment"}
    ]
  }
}
