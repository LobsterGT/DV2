{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Total Enrolment In School By Gender",
  "data": {
    "url": "https://raw.githubusercontent.com/LobsterGT/DV2/refs/heads/main/data/gender_gap.csv"
  },
  "width": "container",
  "height": 310,
  "config": {
    "title": {
      "fontSize": 20,
      "font": "Serif"
    }
  },
  "layer": [
    {
      "name": "line_chart",
      "transform": [
        {
          "filter": "datum.Entity == 'Malaysia'"
        },
        {"filter": "datum.Year >= 2000 && datum.Year <= 2022"},
        {
          "calculate": "(toNumber(datum.primary_male) + toNumber(datum.lower_secondary_education_boys) + toNumber(datum.upper_secondary_education_boys)) / 3",
          "as": "Male"
        },
        {
          "calculate": "(toNumber(datum.primary_female) + toNumber(datum.lower_secondary_education_girls) + toNumber(datum.upper_secondary_education_girls)) / 3",
          "as": "Female"
        },
        {
          "fold": ["Male", "Female"],
          "as": ["gender", "enrolment"]
        }
      ],
      "mark": {
        "type": "line",
        "interpolate": "monotone"
      },
      "encoding": {
        "x": {
          "field": "Year",
          "type": "ordinal",
          "title": "Year",
          "axis": {
            "grid": true
          }
        },
        "y": {
          "field": "enrolment",
          "type": "quantitative",
          "title": "Average Enrolment (%)"
        },
        "color": {
          "field": "gender",
          "type": "nominal",
          "title": "Gender"
        },
        "tooltip": [
          {"field": "Year", "type": "ordinal"},
          {"field": "gender", "title": "Gender"},
          {"field": "enrolment", "type": "quantitative", "title": "Average Enrolment", "format": ",.1f"}
        ]
      }
    },
    {
      "name": "tooltip_hit_area",
      "transform": [
        {
          "filter": "datum.Entity == 'Malaysia'"
        },
        {"filter": "datum.Year >= 2000 && datum.Year <= 2022"},
        {
          "calculate": "(toNumber(datum.primary_male) + toNumber(datum.lower_secondary_education_boys) + toNumber(datum.upper_secondary_education_boys)) / 3",
          "as": "Male"
        },
        {
          "calculate": "(toNumber(datum.primary_female) + toNumber(datum.lower_secondary_education_girls) + toNumber(datum.upper_secondary_education_girls)) / 3",
          "as": "Female"
        },
        {
          "fold": ["Male", "Female"],
          "as": ["gender", "enrolment"]
        }
      ],
      "mark": {
        "type": "point",
        "filled": true,
        "opacity": 0,
        "size": 100
      },
      "encoding": {
        "x": {
          "field": "Year",
          "type": "ordinal"
        },
        "y": {
          "field": "enrolment",
          "type": "quantitative"
        },
        "color": {
          "field": "gender",
          "type": "nominal"
        },
        "tooltip": [
          {"field": "Year", "type": "ordinal", "title": "Year"},
          {"field": "gender", "title": "Gender"},
          {"field": "enrolment", "type": "quantitative", "title": "Average Enrolment", "format": ",.1f"}
        ]
      }
    },
    {
      "transform": [
        {
          "filter": "datum.Entity == 'Malaysia'"
        },
        {"filter": "datum.Year >= 2000 && datum.Year <= 2022"},
        {
          "calculate": "(toNumber(datum.primary_male) + toNumber(datum.lower_secondary_education_boys) + toNumber(datum.upper_secondary_education_boys)) / 3",
          "as": "Male"
        },
        {
          "calculate": "(toNumber(datum.primary_female) + toNumber(datum.lower_secondary_education_girls) + toNumber(datum.upper_secondary_education_girls)) / 3",
          "as": "Female"
        },
        {
          "fold": ["Male", "Female"],
          "as": ["gender", "enrolment"]
        },
        {
          "aggregate": [
            {"op": "argmax", "field": "enrolment", "as": "max_record"}
          ]
        },
        {"calculate": "datum.max_record['Year']", "as": "maxYear"},
        {"calculate": "datum.max_record['enrolment']", "as": "maxEnrolment"},
        {
          "calculate": "'Highest enrolment: ' + format(datum.maxEnrolment, ',.1f') + '%'",
          "as": "label"
        }
      ],
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "bottom",
        "dy": -5,
        "color": "black"
      },
      "encoding": {
        "x": {"field": "maxYear", "type": "ordinal"},
        "y": {"field": "maxEnrolment", "type": "quantitative"},
        "text": {"field": "label", "type": "nominal"}
      }
    },
    {
    "transform": [
      {
        "filter": "datum.Entity == 'Malaysia'"
      },
      {"filter": "datum.Year >= 2000 && datum.Year <= 2022"},
      {
        "calculate": "(toNumber(datum.primary_male) + toNumber(datum.lower_secondary_education_boys) + toNumber(datum.upper_secondary_education_boys)) / 3",
        "as": "Male"
      },
      {
        "calculate": "(toNumber(datum.primary_female) + toNumber(datum.lower_secondary_education_girls) + toNumber(datum.upper_secondary_education_girls)) / 3",
        "as": "Female"
      },
      {
        "fold": ["Male", "Female"],
        "as": ["gender", "enrolment"]
      },
      {
        "aggregate": [
          {"op": "argmax", "field": "enrolment", "as": "max_record"}
        ]
      },
      {"calculate": "datum.max_record['Year']", "as": "maxYear"},
      {"calculate": "datum.max_record['enrolment']", "as": "maxEnrolment"}
    ],
    "mark": {
      "type": "point",
      "filled": true,
      "size": 120,
      "color": "red"
    },
    "encoding": {
      "x": {"field": "maxYear", "type": "ordinal"},
      "y": {"field": "maxEnrolment", "type": "quantitative"}
    }
  }
  ]
}